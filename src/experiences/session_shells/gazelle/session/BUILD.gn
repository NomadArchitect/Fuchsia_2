# Copyright 2022 The Fuchsia Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("//build/components.gni")
import("//build/dart/dart_component.gni")

fuchsia_component("gazelle_session") {
  assert(
      dart_default_build_cfg.is_aot == flutter_default_build_cfg.is_aot &&
          dart_default_build_cfg.is_product ==
              flutter_default_build_cfg.is_product,
      "gazelle_session requires dart and flutter runtimes use the same build configuration. Make sure 'fx set ... --args=(dart|flutter)_force_product=<bool>' flags are omitted, or match, for both dart and flutter.")
  if (!dart_default_build_cfg.is_aot && !dart_default_build_cfg.is_product) {
    manifest = "meta/gazelle_session_jit.cml"
  } else if (!dart_default_build_cfg.is_aot &&
             dart_default_build_cfg.is_product) {
    manifest = "meta/gazelle_session_jit_product.cml"
  } else if (dart_default_build_cfg.is_aot &&
             !dart_default_build_cfg.is_product) {
    manifest = "meta/gazelle_session_aot.cml"
  } else if (dart_default_build_cfg.is_aot &&
             dart_default_build_cfg.is_product) {
    manifest = "meta/gazelle_session_aot_product.cml"
  }
}

fuchsia_package("gazelle_session_pkg") {
  package_name = "gazelle_session"
  deps = [ ":gazelle_session" ]
}

group("session") {
  public_deps = [ ":gazelle_session_pkg" ]
}
