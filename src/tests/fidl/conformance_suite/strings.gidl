// Copyright 2020 The Fuchsia Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

encode_failure("StringExceedsLimit") {
    // TODO(fxbug.dev/37304) Enforce size bounds in rust
    bindings_denylist = [rust, dart],
    value = Length2StringWrapper {
        length_2_string: "abc", // exceeds the string length
    },
    err = STRING_TOO_LONG,
}

decode_failure("NonEmptyStringWithNullPtrBody") {
    type = StringWrapper,
    bytes = {
        v1, v2 = [
            0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // length of string data
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // invalid null pointer to content
        ],
    },
    err = NON_EMPTY_STRING_WITH_NULL_BODY,
}

// Test string with count exceeding 32-bit limit (as defined in RFC-0059).
decode_failure("StringCountExceedsLimit") {
    // TODO(fxbug.dev/82167) go, rust and dart all panic and don't return proper errors
    bindings_denylist = [go, rust, dart],
    type = StringWrapper,
    bytes = {
        v1, v2 = [
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, // length of string data
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, // presence marker
        ]
    },
    err = COUNT_EXCEEDS_LIMIT,
}
