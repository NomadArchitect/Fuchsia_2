# Copyright 2015 The Crashpad Authors. All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# This code snippet is temporarily copied from:
# https://chromium.googlesource.com/crashpad/crashpad/+/refs/heads/main/util/BUILD.gn

import("../../build/crashpad_buildconfig.gni")
import("tls.gni")

# net is split into a separate target from util so that client code does
# not have to depend on it.
crashpad_static_library("net_transition") {
  sources = [
    "http_body.cc",
    "http_body.h",
    "http_body_gzip.cc",
    "http_body_gzip.h",
    "http_headers.h",
    "http_multipart_builder.cc",
    "http_multipart_builder.h",
    "http_transport.cc",
    "http_transport.h",
    "url.cc",
    "url.h",
  ]
  deps = [
    "$mini_chromium_source_parent:base",
    "//third_party/crashpad/util",
  ]
  if (crashpad_is_mac && !crashpad_is_in_fuchsia) {
    sources += [ "http_transport_mac.mm" ]
  }
  if (crashpad_is_ios) {
    sources += [ "http_transport_mac.mm" ]
  }
  if (crashpad_is_win) {
    sources += [ "http_transport_win.cc" ]
  }
  if (crashpad_http_transport_impl == "socket") {
    sources += [ "http_transport_socket.cc" ]
    if (crashpad_use_boringssl_for_http_transport_socket) {
      defines = [ "CRASHPAD_USE_BORINGSSL" ]
      if (crashpad_is_in_chromium || crashpad_is_in_fuchsia) {
        deps += [ "//third_party/boringssl" ]
      } else {
        libs = [
          "crypto",
          "ssl",
        ]
      }
    }
  } else if (crashpad_http_transport_impl == "libcurl") {
    sources += [ "http_transport_libcurl.cc" ]
    if (crashpad_is_in_fuchsia) {
      # Host Linux builds in Fuchsia don't have libcurl in a sysroot.
      deps += [ "//third_party/curl:libcurl" ]
    }
  }
}
